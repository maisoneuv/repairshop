FROM node:20-alpine AS frontend-build
WORKDIR /app

COPY frontend/package*.json ./
RUN npm ci

COPY frontend ./
RUN npm run build

FROM nginx:alpine

COPY docker/nginx.conf /etc/nginx/nginx.conf
RUN mkdir -p /var/www/frontend
COPY --from=frontend-build /app/dist /var/www/frontend
RUN chmod -R a+rX /var/www/frontend

# Provide mount point for Django static files served via alias
RUN mkdir -p /app/staticfiles && chmod -R a+rX /app/staticfiles
